<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhaleWatch.Trade</title>
  <link href="https://fonts.googleapis.com/css2?family=Segoe+UI&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #001d2d;
      color: white;
      margin: 0;
      padding: 0;
    }
    nav {
      background-color: #001520;
      padding: 1em;
      text-align: center;
    }
    nav a {
      color: #00ffee;
      font-weight: bold;
      text-decoration: none;
      margin: 0 1em;
    }
    .section {
      padding: 2em;
      border-bottom: 1px solid #003344;
    }
    h2 {
      color: #00ffee;
    }
    .trade-card, .suggested-trade {
      background: radial-gradient(circle at center, #0c344a, #001d2d);
      border: 1px solid #00ffee88;
      padding: 1em;
      border-radius: 12px;
      margin-bottom: 1em;
    }
    .suggested-trade {
      background-color: #0b2a3a;
      font-size: 1.05em;
    }
    .timestamp, .tip {
      font-size: 0.9em;
      color: #aaa;
    }
    #whalebotIcon {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 2.2em;
      cursor: pointer;
      filter: drop-shadow(0 0 6px #00ffee);
    }
    #whalebotPanel {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 20px;
      background-color: #012733;
      padding: 1em;
      border-radius: 10px;
      max-width: 260px;
      box-shadow: 0 0 12px #00ffee;
    }
  </style>
</head>
<body>

  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="simulate.html">Simulate</a>
    <a href="harvesting.html">Premium Harvesting</a>
    <a href="whisper.html">Whispers</a>
  </nav>

  <div class="section">
    <h2>üìí Live Trader Log</h2>
    <div id="liveTrade" class="trade-card">Loading latest trade...</div>
    <p class="tip">Want to see all my trades? <a href="whisper.html">Unlock Premium Access</a>.</p>
  </div>

  <div class="section">
    <h2>üßæ Weekly Premium Harvest Plan</h2>
    <div id="harvestPlan" class="trade-card">Loading plan...</div>
  </div>

  <div class="section">
    <h2>üîç Suggested Trade Based on Whale + Shark Signals <span style="color:#ffaa00">(üîí Premium Preview)</span></h2>
    <div id="suggestedTrade" class="suggested-trade">Loading...</div>
  </div>

  <div class="section">
    <h2>üß± Shark Meter</h2>
    <div class="trade-card" id="sharkList">Loading...</div>
  </div>

  <div class="section">
    <h2>üö® Shark Alert</h2>
    <div class="trade-card" id="sharkAlert">Loading latest alert...</div>
  </div>

  <div id="whalebotIcon" onclick="toggleWhaleBot()">üê≥</div>
  <div id="whalebotPanel">
    <strong>WhaleBot</strong><br>
    Ask me anything about trading.<br><br>
    ‚Ä¢ Covered calls<br>
    ‚Ä¢ Put selling<br>
    ‚Ä¢ Whale trades<br>
    ‚Ä¢ Premium harvesting
  </div>

  <script>
    function toggleWhaleBot() {
      const panel = document.getElementById('whalebotPanel');
      panel.style.display = panel.style.display === 'block' ? 'none' : 'block';
    }

    async function loadWhaleWatchData() {
      try {
        const [trades, harvest, sharks, whales] = await Promise.all([
          fetch('trades.json').then(res => res.json()),
          fetch('harvest.json').then(res => res.json()),
          fetch('sharks.json').then(res => res.json()),
          fetch('whales.json').then(res => res.json()),
        ]);

        // Live Trade Log
        const latest = trades.trades?.[0];
        if (latest) {
          document.getElementById('liveTrade').innerHTML = `
            <div><strong>${latest.symbol}</strong> ‚Äî ${latest.type}<br>
            Strike: $${latest.strike}, Exp: ${latest.expiration}<br>
            Premium: $${latest.premium} √ó ${latest.size} = <strong>$${(latest.premium * latest.size).toFixed(2)}</strong><br>
            Status: <span style="color:${latest.status === 'OPEN' ? '#00ff88' : '#ccc'}">${latest.status}</span> (${latest.date})</div>
          `;
        }

        // Weekly Harvest Plan
        const harvestDiv = document.getElementById('harvestPlan');
        let html = `<p><strong>Week:</strong> ${harvest.week}</p>`;
        html += `<p><strong>Target:</strong> $${harvest.premium_goal} | <strong>Total:</strong> $${harvest.total_premium}</p>`;
        for (const [account, info] of Object.entries(harvest.accounts)) {
          html += `<h3>${account}</h3>`;
          if (info.puts?.length) {
            html += `<strong>Puts:</strong><ul>`;
            info.puts.forEach(p => {
              const total = p.premium * 100 * p.contracts;
              html += `<li>${p.contracts}x ${p.symbol} $${p.strike} Put @ $${p.premium} = $${total.toFixed(2)}</li>`;
            });
            html += `</ul>`;
          }
          if (info.calls?.length) {
            html += `<strong>Calls:</strong><ul>`;
            info.calls.forEach(c => {
              const total = c.premium * 100 * c.contracts;
              html += `<li>${c.contracts}x ${c.symbol} $${c.strike} Call @ $${c.premium} = $${total.toFixed(2)}</li>`;
            });
            html += `</ul>`;
          }
        }
        harvestDiv.innerHTML = html;

        // Shark Meter
        document.getElementById('sharkList').innerHTML = sharks.shark_trades.map(s => `
          <div>üîî <strong>${s.symbol}</strong> ‚Äî $${s.average_price}, Vol: ${s.total_volume.toLocaleString()}<br>
          Confidence: <strong>${s.confidence}</strong></div>`).join("<hr>");

        // Shark Alert
        const alert = sharks.shark_trades?.[0];
        if (alert) {
          document.getElementById('sharkAlert').innerHTML = `
            üö® <strong>${alert.symbol}</strong> ‚Äî High volume alert<br>
            Avg Price: $${alert.average_price}, Volume: ${alert.total_volume.toLocaleString()}<br>
            Confidence: <strong style="color:#ffaa00">${alert.confidence}</strong>`;
        }

        // Suggested Trade (Whale + Shark Alignment)
        const match = sharks.shark_trades.find(s => whales.whale_trades.some(w => w.symbol === s.symbol));
        document.getElementById('suggestedTrade').innerHTML = match ? `
          üìå Based on activity in <strong>${match.symbol}</strong>, consider selling a put near $${Math.floor(match.average_price)}.
          <br><span style="font-size:0.9em;color:#ccc;">Institutional interest aligns across both whales and sharks.</span>`
          : "No alignment today. Explore other setups.";

      } catch (err) {
        console.error("Error loading data:", err);
      }
    }

    loadWhaleWatchData();
  </script>
</body>
</html>
