<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhaleWatch | Home</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #001d2d;
      color: white;
      margin: 0;
      padding: 0;
    }
    nav {
      background-color: #001520;
      padding: 1em;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 1em;
      flex-wrap: wrap;
    }
    nav a {
      color: #00ffee;
      font-weight: bold;
      text-decoration: none;
    }
    .hero {
      text-align: center;
      padding: 4em 2em 2em;
      background-color: #002b3f;
    }
    .whale-hero {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .homepage-logo {
      width: 100px;
      height: auto;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 10px #00ffee);
    }
    .hero h1 {
      font-size: 3em;
      color: #00ffee;
      margin-bottom: 0.3em;
    }
    .hero p {
      font-size: 1.2em;
      color: #ccc;
      margin-bottom: 1.5em;
    }
    .cta-button {
      display: inline-block;
      padding: 0.75em 1.5em;
      background-color: #00ffee;
      color: #001520;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.2s ease-in-out;
    }
    .cta-button:hover {
      background-color: #00ddcc;
    }
    .section {
      max-width: 800px;
      margin: 3em auto;
      padding: 2em;
    }
    .section h2 {
      color: #00ffee;
      margin-bottom: 0.5em;
    }
    .whale-meter-container,
    .sentiment-bar,
    .sentiment-timeline {
      background-color: #103b52;
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      margin-top: 8px;
    }
    .whale-meter-fill,
    .sentiment-fill-bullish,
    .sentiment-fill-bearish {
      height: 100%;
      width: 0;
      float: left;
      transition: width 1.5s ease-in-out;
    }
    .sentiment-timeline-bar {
      height: 100%;
      display: flex;
    }
    .sentiment-timeline-bar span {
      flex: 1;
      background-color: #00ff88;
      transition: background-color 0.4s ease;
    }
    .whale-meter-text,
    .timestamp,
    .whale-tip {
      font-size: 0.95em;
      color: #aaa;
    }
    .trade-card {
      background: #0c344a;
      padding: 1em;
      border-radius: 8px;
      margin-bottom: 1em;
    }
    #whaleBotBox {
      position: fixed;
      bottom: 1em;
      right: 1em;
      background: #002b3f;
      border: 2px solid #00ffee;
      padding: 1em;
      border-radius: 12px;
      font-size: 0.9em;
      width: 240px;
      box-shadow: 0 0 15px #00ffee88;
    }
    #whaleBotBox h3 {
      margin-top: 0;
      color: #00ffee;
    }
    #whaleBotBox ul {
      padding-left: 1.2em;
    }
    #whaleBotBox li {
      margin-bottom: 0.4em;
    }
  </style>
</head>
<body>
  <div id="liveClockBanner">ðŸ•’ Market Clock: <span id="liveClock">Loading...</span></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="simulate.html">Simulate</a>
    <a href="harvesting.html">Premium Harvesting</a>
    <a href="whisper.html">Whispers</a>
  </nav>
  <div class="hero whale-hero">
    <img src="/whale.png" alt="WhaleWatch Logo" class="homepage-logo">
    <h1>WhaleWatch.Trade</h1>
    <p>We track the whales so you can harvest the premium.</p>
    <a href="harvesting.html" class="cta-button">What Is Premium Harvesting?</a>
  </div>

  <div class="section">
    <h2>ðŸ“ˆ Bullish vs. Bearish Sentiment</h2>
    <div class="sentiment-bar">
      <div id="bullFill" class="sentiment-fill-bullish" style="background-color:#00ff88;"></div>
      <div id="bearFill" class="sentiment-fill-bearish" style="background-color:#ff0044;"></div>
    </div>
    <div id="sentimentLabel" class="whale-meter-text" style="margin-top: 10px;">Loading...</div>
    <p class="whale-tip"><em>This chart shows how many large trades were calls vs. puts â€” not dollars, just number of trades.</em></p>
  </div>

  <div class="section">
    <h2>ðŸ“‰ Sentiment Timeline</h2>
    <div class="sentiment-timeline">
      <div id="sentimentTimelineBar" class="sentiment-timeline-bar"></div>
    </div>
    <p class="whale-tip" id="timelineTip">Loading whale confidence trend...</p>
  </div>

  <div class="section">
    <h2>ðŸ“Š Latest Whale Trades</h2>
    <div id="whaleList">Loading...</div>
    <p class="whale-tip">
      <em>These are the top 10 highest-premium options trades â€” filtered by size, strike, and expiration. Think of them as the largest foam trails left behind by whales. Watch for patterns and use them to guide your own simulated or real trades.</em>
    </p>
  </div>

  <div id="whaleBotBox">
    <h3>ðŸ¤– WhaleBot</h3>
    <p>Ask me anything about:</p>
    <ul>
      <li>â€¢ Covered calls</li>
      <li>â€¢ Put selling</li>
      <li>â€¢ Whale trades</li>
      <li>â€¢ Premium harvesting</li>
    </ul>
    <p style="color: #aaa; font-size: 0.8em;">(Coming soon: live chat!)</p>
  </div>

  <script>
    function updateLiveClock() {
      const now = new Date();
      document.getElementById("liveClock").textContent = now.toLocaleTimeString();
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();

    function updateWhaleData() {
      fetch("/whales.json")
        .then(res => res.json())
        .then(data => {
          const trades = data.whale_trades || [];
          const totalPremium = trades.reduce((sum, t) => sum + Number(t.premium), 0);
          const bullishCount = trades.filter(t => t.type === "CALL").length;
          const bearishCount = trades.filter(t => t.type === "PUT").length;
          const totalCount = bullishCount + bearishCount;
          const bullishPct = totalCount > 0 ? (bullishCount / totalCount) * 100 : 50;
          const bearishPct = 100 - bullishPct;

          document.getElementById("bullFill").style.width = `${bullishPct}%`;
          document.getElementById("bearFill").style.width = `${bearishPct}%`;
          document.getElementById("sentimentLabel").textContent =
            `ðŸ‚ Bullish: ${bullishPct.toFixed(1)}% | ðŸ» Bearish: ${bearishPct.toFixed(1)}%`;

          const listHTML = trades.map(t => `
            <div class="trade-card">
              <strong>${t.symbol}</strong> â€” ${t.type}<br>
              Strike: $${t.strike}, Exp: ${t.expiration}, Premium: $${Number(t.premium).toLocaleString()}
            </div>
          `).join("");
          document.getElementById("whaleList").innerHTML = listHTML;
        });
    }

    function updateSentimentTimeline() {
      fetch("/sentiment.json")
        .then(res => res.json())
        .then(data => {
          const timeline = data.sentiment_timeline || [];
          const bar = document.getElementById("sentimentTimelineBar");
          bar.innerHTML = "";

          timeline.forEach((point, index) => {
            const span = document.createElement("span");
            span.style.flex = 1;
            span.style.backgroundColor = "#00ff88";
            bar.appendChild(span);
          });

          const latest = timeline[timeline.length - 1];
          if (latest.bullish_pct >= 80) {
            document.getElementById("timelineTip").textContent =
              "The whales have been getting more confident. Watch for foam buildup before a possible wave.";
          } else {
            document.getElementById("timelineTip").textContent =
              "Sentiment is mixed. Whales may be positioning cautiously.";
          }
        });
    }

    updateWhaleData();
    updateSentimentTimeline();
    setInterval(updateWhaleData, 60000);
    setInterval(updateSentimentTimeline, 300000);
  </script>
</body>
</html>
