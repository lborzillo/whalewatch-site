<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhaleWatch | Home</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #001d2d;
      color: white;
      margin: 0;
      padding: 0;
    }

    nav {
      background-color: #001520;
      padding: 1em;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 1em;
      flex-wrap: wrap;
    }

    nav a {
      color: #00ffee;
      font-weight: bold;
      text-decoration: none;
    }

    .hero {
      text-align: center;
      padding: 4em 2em 2em;
      background-color: #002b3f;
    }

    .whale-hero {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .homepage-logo {
      width: 100px;
      height: auto;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 12px #00ffee);
    }

    .hero h1 {
      font-size: 3em;
      color: #00ffee;
      margin-bottom: 0.3em;
    }

    .hero p {
      font-size: 1.2em;
      color: #ccc;
      margin-bottom: 1.5em;
    }

    .cta-button {
      display: inline-block;
      padding: 0.75em 1.5em;
      background-color: #00ffee;
      color: #001520;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.2s ease-in-out;
    }

    .cta-button:hover {
      background-color: #00ddcc;
    }

    .section {
      max-width: 800px;
      margin: 3em auto;
      padding: 2em;
    }

    .section h2 {
      color: #00ffee;
      margin-bottom: 0.5em;
    }

    .whale-meter-container,
    .timeline-bar {
      background-color: #003850;
      border-radius: 6px;
      overflow: hidden;
      height: 30px;
      margin-bottom: 1em;
    }

    .whale-meter-fill {
      height: 100%;
      width: 0;
      transition: width 2s ease-in-out;
    }

    .whale-meter-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1em;
      margin-bottom: 1em;
    }

    .whale-meter-text {
      font-weight: bold;
      color: #00ffee;
      font-size: 1.1em;
    }

    .timestamp {
      font-size: 0.9em;
      color: #aaa;
    }

    .sentiment-bar {
      background-color: #00425f;
      border-radius: 6px;
      height: 20px;
      overflow: hidden;
      margin-top: 10px;
    }

    .sentiment-fill-bullish {
      background-color: #00ff88;
      height: 100%;
      width: 0;
      float: left;
      transition: width 1.5s ease-in-out;
    }

    .sentiment-fill-bearish {
      background-color: #ff0044;
      height: 100%;
      width: 0;
      float: left;
      transition: width 1.5s ease-in-out;
    }

    .trade-card {
      background: #0c344a;
      padding: 1em;
      border-radius: 8px;
      margin-bottom: 1em;
    }

    #whaleBotBox {
      position: fixed;
      bottom: 1em;
      right: 1em;
      background: #002b3f;
      border: 2px solid #00ffee;
      padding: 1em;
      border-radius: 12px;
      font-size: 0.9em;
      width: 240px;
      box-shadow: 0 0 15px #00ffee; /* ✨ GLOW EFFECT MATCHES WHALE */
    }

    #whaleBotBox h3 {
      margin-top: 0;
      color: #00ffee;
    }

    #whaleBotBox ul {
      padding-left: 1.2em;
    }

    #whaleBotBox li {
      margin-bottom: 0.4em;
    }

    .sentiment-tip {
      font-style: italic;
      font-size: 0.95em;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="hero whale-hero">
    <img src="/whale.png" alt="WhaleWatch Logo" class="homepage-logo" />
    <h1>WhaleWatch.Trade</h1>
    <p>We track the whales so you can harvest the premium.</p>
    <a href="harvesting.html" class="cta-button">What Is Premium Harvesting?</a>
  </div>

  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="simulate.html">Simulate</a>
    <a href="harvesting.html">Premium Harvesting</a>
    <a href="whisper.html">Whispers</a>
  </nav>

  <div class="section">
    <h2>🌊 Whale Meter</h2>
    <div class="whale-meter-container">
      <div id="whaleFill" class="whale-meter-fill"></div>
    </div>
    <div class="whale-meter-flex">
      <div id="whaleMeterText" class="whale-meter-text">Loading...</div>
      <div id="whaleTimestamp" class="timestamp">Loading...</div>
    </div>
    <p style="margin: 0.2em 0;">
      <span style="color: #00ff88;">🟢 Green = Bullish (Calls)</span> ·
      <span style="color: #ff0044;">🔴 Red = Bearish (Puts)</span> ·
      🎨 Gradient = Mixed Premium Flow
    </p>
    <p class="sentiment-tip">
      The Whale Meter shows where the most capital is currently concentrated in the options market, based on open interest and last traded price. These are not necessarily trades placed today, but represent the largest active bets for the nearest expiration.
    </p>
  </div>

  <div class="section">
    <h2>📈 Bullish vs. Bearish Sentiment</h2>
    <div class="sentiment-bar">
      <div id="bullFill" class="sentiment-fill-bullish"></div>
      <div id="bearFill" class="sentiment-fill-bearish"></div>
    </div>
    <div id="sentimentLabel" class="whale-meter-text" style="margin-top: 10px;">Loading...</div>
    <p class="sentiment-tip">
      This chart shows how many large option trades were bullish (calls) vs. bearish (puts) — not dollars, just number of trades.
    </p>
  </div>

  <div class="section">
    <h2>📉 Sentiment Timeline</h2>
    <div class="timeline-bar" id="sentimentTimeline">Loading trend...</div>
    <p class="sentiment-tip">
      The whales have been getting more confident. Watch for foam buildup before a possible wave.
    </p>
  </div>

  <div class="section">
    <h2>📊 Latest Whale Trades</h2>
    <div id="whaleList">Loading...</div>
    <p class="sentiment-tip">
      These are the top 10 highest-premium options trades — filtered by size, strike, and expiration. Think of them as the largest foam trails left behind by whales.
    </p>
  </div>

  <div id="whaleBotBox">
    <h3>🤖 WhaleBot</h3>
    <p>Ask me anything about:</p>
    <ul>
      <li>• Covered calls</li>
      <li>• Put selling</li>
      <li>• Whale trades</li>
      <li>• Premium harvesting</li>
    </ul>
    <p style="color: #aaa; font-size: 0.8em;">(Coming soon: live chat!)</p>
  </div>

  <script>
    function updateWhaleData() {
      fetch("/whales.json")
        .then(res => res.json())
        .then(data => {
          const trades = data.whale_trades || [];
          const ts = new Date(data.timestamp);
          document.getElementById("whaleTimestamp").textContent =
            `Last updated: ${ts.toLocaleString()}`;

          const listHTML = trades.map(t => `
            <div class="trade-card">
              <strong>${t.symbol}</strong> — ${t.type}<br>
              Strike: $${t.strike}, Exp: ${t.expiration}, Premium: $${Number(t.premium).toLocaleString()}
            </div>
          `).join("");
          document.getElementById("whaleList").innerHTML = listHTML;

          const totalPremium = trades.reduce((sum, t) => sum + Number(t.premium), 0);
          document.getElementById("whaleMeterText").textContent =
            `Total Premium Traded: $${(totalPremium * 10000).toLocaleString()}`;

          const percent = Math.min((totalPremium * 10000 / 1000000) * 100, 100);
          const whaleFill = document.getElementById("whaleFill");
          whaleFill.style.width = percent + "%";
          whaleFill.style.background = "linear-gradient(to right, #00ff88, #ffaa00, #ff0044)";

          const bullishCount = trades.filter(t => t.type === "CALL").length;
          const bearishCount = trades.filter(t => t.type === "PUT").length;
          const totalCount = bullishCount + bearishCount;
          const bullishPct = totalCount > 0 ? (bullishCount / totalCount) * 100 : 50;
          const bearishPct = 100 - bullishPct;

          document.getElementById("bullFill").style.width = `${bullishPct}%`;
          document.getElementById("bearFill").style.width = `${bearishPct}%`;
          document.getElementById("sentimentLabel").textContent =
            `🐂 Bullish: ${bullishPct.toFixed(1)}% | 🐻 Bearish: ${bearishPct.toFixed(1)}%`;
        })
        .catch(err => {
          console.error("Failed to fetch whale data:", err);
          document.getElementById("whaleTimestamp").textContent = "Failed to load whale data.";
        });

      fetch("/sentiment.json")
        .then(res => res.json())
        .then(data => {
          const timeline = data.sentiment_timeline || [];
          if (timeline.length === 0) return;

          const segments = timeline.map(entry => {
            const width = (100 / timeline.length).toFixed(2);
            const color = `hsl(${Math.floor(120 * (entry.bullish_pct / 100))}, 100%, 50%)`;
            return `<div style="width: ${width}%; height: 100%; background: ${color}; float: left;"></div>`;
          }).join("");

          document.getElementById("sentimentTimeline").innerHTML = segments;
        })
        .catch(err => {
          console.error("Failed to load sentiment timeline:", err);
          document.getElementById("sentimentTimeline").textContent = "Failed to load trend data.";
        });
    }

    updateWhaleData();
    setInterval(updateWhaleData, 60000);
  </script>
</body>
</html>
