<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WhaleWatch | Home</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #001d2d;
      color: white;
      margin: 0;
      padding: 0;
    }
    nav {
      background-color: #001520;
      padding: 1em;
      text-align: center;
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1em;
    }
    nav a {
      color: #00ffee;
      font-weight: bold;
      text-decoration: none;
    }
    .hero {
      text-align: center;
      padding: 4em 2em 2em;
      background-color: #002b3f;
    }
    .hero img {
      width: 100px;
      filter: drop-shadow(0 0 12px #00ffee);
    }
    h1 {
      font-size: 3em;
      color: #00ffee;
      margin: 0.3em 0;
    }
    .cta-button {
      background: #00ffee;
      color: #001520;
      padding: 0.75em 1.5em;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      transition: 0.2s;
    }
    .cta-button:hover {
      background: #00ddcc;
    }
    .section {
      max-width: 900px;
      margin: 2.5em auto;
      padding: 0 1em;
    }
    h2 {
      color: #00ffee;
      display: flex;
      align-items: center;
      gap: 0.5em;
    }
    .bar-container {
      background: #08394f;
      height: 26px;
      border-radius: 6px;
      overflow: hidden;
      margin: 0.5em 0;
    }
    .fill {
      height: 100%;
      transition: width 1s ease-in-out;
    }
    .whale-fill {
      background: linear-gradient(to right, #00ff88, #ffaa00, #ff0044);
    }
    .bull-fill {
      background-color: #00ff88;
      float: left;
    }
    .bear-fill {
      background-color: #ff0044;
      float: left;
    }
    .sentiment-bar-segment {
      float: left;
      height: 100%;
      background-color: #00ff88;
    }
    .timestamp, .tip {
      font-size: 0.95em;
      color: #aaa;
    }
    .legend {
      margin-top: 0.5em;
      font-size: 0.9em;
    }
    .legend span {
      margin-right: 1em;
    }
    .legend span::before {
      content: '‚óè';
      margin-right: 0.3em;
    }
    .legend .bullish { color: #00ff88; }
    .legend .bearish { color: #ff0044; }
    .legend .mixed { color: #ffaa00; }

    .card {
      background: #0c344a;
      padding: 1em;
      margin-top: 1em;
      border-radius: 8px;
    }

    #whaleBotBox {
      position: fixed;
      bottom: 1em;
      right: 1em;
      background: #002b3f;
      border: 2px solid #00ffee;
      border-radius: 12px;
      padding: 1em;
      width: 240px;
      box-shadow: 0 0 18px #00ffee;
      font-size: 0.9em;
    }
    #whaleBotBox h3 {
      color: #00ffee;
      margin-top: 0;
    }
    #whaleBotBox ul {
      padding-left: 1.2em;
    }
    #whaleBotBox li {
      margin-bottom: 0.4em;
    }

    @media (max-width: 600px) {
      .hero img {
        width: 80px;
      }
      h1 {
        font-size: 2em;
      }
      #whaleBotBox {
        width: auto;
        bottom: 0.5em;
        right: 0.5em;
      }
    }
  </style>
</head>
<body>
  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="simulate.html">Simulate</a>
    <a href="harvesting.html">Premium Harvesting</a>
    <a href="whisper.html">Whispers</a>
  </nav>
  <div class="hero">
    <img src="whale.png" alt="Whale Logo">
    <h1>WhaleWatch.Trade</h1>
    <p>We track the whales so you can harvest the premium.</p>
    <a href="harvesting.html" class="cta-button">What Is Premium Harvesting?</a>
  </div>

  <div class="section">
    <h2>üåä Whale Meter</h2>
    <div class="bar-container">
      <div id="whaleFill" class="fill whale-fill" style="width: 0%;"></div>
    </div>
    <div><strong id="whaleMeterText">Loading...</strong></div>
    <div class="timestamp" id="whaleTimestamp">Loading...</div>
    <div class="legend">
      <span class="bullish">Green = Bullish (Calls)</span>
      <span class="bearish">Red = Bearish (Puts)</span>
      <span class="mixed">üé® Gradient = Mixed Premium Flow</span>
    </div>
    <p class="tip"><em>The Whale Meter shows where the most capital is flowing in the options market ‚Äî based on open interest and last traded price. Not all trades are from today, but they reflect current positioning.</em></p>
  </div>

  <div class="section">
    <h2>üìà Bullish vs. Bearish Sentiment</h2>
    <div class="bar-container">
      <div id="bullFill" class="fill bull-fill" style="width: 0%;"></div>
      <div id="bearFill" class="fill bear-fill" style="width: 0%;"></div>
    </div>
    <div id="sentimentLabel"><strong>Loading...</strong></div>
    <p class="tip"><em>This shows how many whale trades were bullish vs. bearish ‚Äî not dollars, just number of trades.</em></p>
  </div>

  <div class="section">
    <h2>üìâ Sentiment Timeline</h2>
    <div class="bar-container" id="sentimentTimeline"></div>
    <p class="tip" id="timelineInsight">Loading whale confidence trend...</p>
  </div>

  <div class="section">
    <h2>ü¶à Shark Meter (Dark Pool)</h2>
    <div id="sharkList">Loading...</div>
    <p class="tip"><em>Dark pool activity is shown here based on off-exchange trading volume. These trades are not always predictive ‚Äî but can show where institutional money might be moving. Powered by FINRA ATS.</em></p>
  </div>

  <div id="whaleBotBox">
    <h3>ü§ñ WhaleBot</h3>
    <p>Ask me anything about:</p>
    <ul>
      <li>‚Ä¢ Covered calls</li>
      <li>‚Ä¢ Put selling</li>
      <li>‚Ä¢ Whale trades</li>
      <li>‚Ä¢ Premium harvesting</li>
    </ul>
    <p style="color: #aaa; font-size: 0.8em;">(Coming soon: live chat!)</p>
  </div>

  <script>
    function fetchJSON(file) {
      return fetch(file).then(res => res.ok ? res.json() : Promise.reject(res.status));
    }

    function updateWhaleData() {
      fetchJSON("whales.json").then(data => {
        const trades = data.whale_trades || [];
        const ts = new Date(data.timestamp);
        document.getElementById("whaleTimestamp").textContent = `Last updated: ${ts.toLocaleString()}`;
        const total = trades.reduce((sum, t) => sum + Number(t.premium), 0);
        document.getElementById("whaleMeterText").textContent = `Total Premium Traded: $${(total * 10000).toLocaleString()}`;
        document.getElementById("whaleFill").style.width = Math.min((total * 10000 / 1000000) * 100, 100) + "%";
        const bull = trades.filter(t => t.type === "CALL").length;
        const bear = trades.filter(t => t.type === "PUT").length;
        const all = bull + bear;
        const bullPct = all ? (bull / all * 100) : 50;
        const bearPct = 100 - bullPct;
        document.getElementById("bullFill").style.width = bullPct + "%";
        document.getElementById("bearFill").style.width = bearPct + "%";
        document.getElementById("sentimentLabel").textContent = `üêÇ Bullish: ${bullPct.toFixed(1)}% | üêª Bearish: ${bearPct.toFixed(1)}%`;
      }).catch(() => {
        document.getElementById("whaleMeterText").textContent = "Failed to load whale data.";
      });
    }

    function updateTimeline() {
      fetchJSON("sentiment.json").then(data => {
        const timeline = data.sentiment_timeline || [];
        const timelineContainer = document.getElementById("sentimentTimeline");
        timelineContainer.innerHTML = '';
        let prev = 0;
        timeline.forEach((point, i) => {
          const bar = document.createElement('div');
          bar.className = "sentiment-bar-segment";
          bar.style.width = `${100 / timeline.length}%`;
          const green = Math.round(100 - point.bearish_pct * 2);
          bar.style.backgroundColor = `hsl(${green}, 90%, 55%)`;
          timelineContainer.appendChild(bar);
          prev = point.bullish_pct;
        });
        const trend = timeline[timeline.length - 1].bullish_pct - timeline[0].bullish_pct;
        document.getElementById("timelineInsight").textContent =
          trend > 10
            ? "The whales have been getting more confident. Watch for foam buildup before a possible wave."
            : trend < -10
              ? "Whale confidence is fading. Be cautious ‚Äî a pullback might follow."
              : "Confidence has been steady. No clear shift in momentum‚Ä¶ yet.";
      });
    }

    function updateSharkData() {
      fetchJSON("sharks.json").then(data => {
        const list = document.getElementById("sharkList");
        list.innerHTML = data.shark_trades.map(trade => `
          <div class="card">
            <strong>${trade.symbol}</strong> ‚Äî Volume: ${trade.volume.toLocaleString()} @ $${trade.avg_price.toFixed(2)}<br>
            <small>${trade.date} | Venue: ${trade.venue}</small>
          </div>
        `).join('');
      });
    }

    updateWhaleData();
    updateTimeline();
    updateSharkData();
    setInterval(updateWhaleData, 60000);
  </script>
</body>
</html>
