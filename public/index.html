<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>WhaleWatch | Home</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #001d2d;
      color: white;
      margin: 0;
      padding: 0;
    }
    nav {
      background-color: #001520;
      padding: 1em;
      text-align: center;
      display: flex;
      justify-content: center;
      gap: 1em;
      flex-wrap: wrap;
    }
    nav a {
      color: #00ffee;
      font-weight: bold;
      text-decoration: none;
    }
    .hero {
      text-align: center;
      padding: 4em 2em 2em;
      background-color: #002b3f;
    }
    .whale-hero {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .homepage-logo {
      width: 100px;
      height: auto;
      margin-bottom: 1rem;
      filter: drop-shadow(0 0 10px #00ffee);
    }
    .hero h1 {
      font-size: 3em;
      color: #00ffee;
      margin-bottom: 0.3em;
    }
    .hero p {
      font-size: 1.2em;
      color: #ccc;
      margin-bottom: 1.5em;
    }
    .hero a.cta-button {
      display: inline-block;
      padding: 0.75em 1.5em;
      background-color: #00ffee;
      color: #001520;
      font-weight: bold;
      border-radius: 8px;
      text-decoration: none;
      transition: background-color 0.2s ease-in-out;
    }
    .hero a.cta-button:hover {
      background-color: #00ddcc;
    }
    .section {
      max-width: 800px;
      margin: 3em auto;
      padding: 2em;
    }
    .section h2 {
      color: #00ffee;
      margin-bottom: 0.5em;
    }
    .whale-meter-container {
      background-color: #003850;
      border-radius: 6px;
      overflow: hidden;
      height: 30px;
      margin-bottom: 1em;
    }
    .whale-meter-fill {
      height: 100%;
      width: 0;
      transition: width 2s ease-in-out;
    }
    .whale-meter-flex {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1em;
      margin-bottom: 1em;
    }
    .whale-meter-text {
      font-weight: bold;
      color: #00ffee;
      font-size: 1.1em;
    }
    .timestamp {
      font-size: 0.9em;
      color: #aaa;
    }
    .sentiment-bar {
      background-color: #00425f;
      border-radius: 6px;
      height: 20px;
      overflow: hidden;
      margin-top: 10px;
    }
    .sentiment-fill-bullish {
      background-color: #00ff88;
      height: 100%;
      width: 0;
      float: left;
      transition: width 1.5s ease-in-out;
    }
    .sentiment-fill-bearish {
      background-color: #ff0044;
      height: 100%;
      width: 0;
      float: left;
      transition: width 1.5s ease-in-out;
    }
    .trade-card {
      background: #0c344a;
      padding: 1em;
      border-radius: 8px;
      margin-bottom: 1em;
    }
    #whaleBotBox {
      position: fixed;
      bottom: 1em;
      right: 1em;
      background: #002b3f;
      border: 2px solid #00ffee;
      padding: 1em;
      border-radius: 12px;
      font-size: 0.9em;
      width: 240px;
      box-shadow: 0 0 12px #00ffee55;
    }
    #whaleBotBox h3 {
      margin-top: 0;
      color: #00ffee;
    }
    #whaleBotBox ul {
      padding-left: 1.2em;
    }
    #whaleBotBox li {
      margin-bottom: 0.4em;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div id="liveClockBanner">üïí Market Clock: <span id="liveClock">Loading...</span></div>
  <nav>
    <a href="index.html">Home</a>
    <a href="learn.html">Learn</a>
    <a href="simulate.html">Simulate</a>
    <a href="harvesting.html">Premium Harvesting</a>
    <a href="whisper.html">Whispers</a>
  </nav>
  <div class="hero whale-hero">
    <img src="/whale.png" alt="WhaleWatch Logo" class="homepage-logo">
    <h1>WhaleWatch.Trade</h1>
    <p>We track the whales so you can harvest the premium.</p>
    <a href="harvesting.html" class="cta-button">What Is Premium Harvesting?</a>
  </div>

  <div class="section">
    <h2>üåä Whale Meter</h2>
    <div class="whale-meter-container">
      <div id="whaleFill" class="whale-meter-fill"></div>
    </div>
    <div class="whale-meter-flex">
      <div id="whaleMeterText" class="whale-meter-text">Loading...</div>
      <div id="whaleTimestamp" class="timestamp">Loading...</div>
    </div>
    <p style="margin: 0.2em 0;"><span style="color: #00ff88;">üü¢ Green = Bullish (Calls)</span> ¬∑ <span style="color: #ff0044;">üî¥ Red = Bearish (Puts)</span> ¬∑ üé® Gradient = Mixed Premium Flow</p>
    <p style="font-size: 0.95em; color: #aaa; margin-top: 0.5em;">
      <em>The Whale Meter shows where the most capital is currently concentrated in the options market, based on open interest and last traded price. These are not necessarily trades placed today, but represent the largest active bets for the nearest expiration.</em>
    </p>
  </div>

  <div class="section">
    <h2>üìà Bullish vs. Bearish Sentiment</h2>
    <div class="sentiment-bar">
      <div id="bullFill" class="sentiment-fill-bullish"></div>
      <div id="bearFill" class="sentiment-fill-bearish"></div>
    </div>
    <div id="sentimentLabel" class="whale-meter-text" style="margin-top: 10px;">Loading...</div>
    <p style="font-size: 0.95em; color: #aaa; margin-top: 0.4em;">
      <em>This chart shows how many large option trades were bullish (calls) vs. bearish (puts). It helps gauge which direction the whales are leaning ‚Äî not how much they spent, just how many bets were placed.</em>
    </p>
  </div>

  <div class="section">
    <h2>üìâ Sentiment Timeline</h2>
    <canvas id="sentimentChart" width="600" height="300"></canvas>
    <p id="sentimentInsight" style="font-size: 0.95em; color: #aaa; margin-top: 0.5em;">
      Loading insight...
    </p>
  </div>

  <div class="section">
    <h2>üìä Latest Whale Trades</h2>
    <div id="whaleList">Loading...</div>
    <p style="font-size: 0.95em; color: #aaa; margin-top: 0.5em;">
      <em>These are the top 10 highest-premium options trades ‚Äî filtered by size, strike, and expiration. Think of them as the largest foam trails left behind by whales. Watch for patterns and use them to guide your own simulated or real trades.</em>
    </p>
  </div>

  <div id="whaleBotBox">
    <h3>ü§ñ WhaleBot</h3>
    <p>Ask me anything about:</p>
    <ul>
      <li>‚Ä¢ Covered calls</li>
      <li>‚Ä¢ Put selling</li>
      <li>‚Ä¢ Whale trades</li>
      <li>‚Ä¢ Premium harvesting</li>
    </ul>
    <p style="color: #aaa; font-size: 0.8em;">(Coming soon: live chat!)</p>
  </div>

  <script>
    function updateLiveClock() {
      const now = new Date();
      document.getElementById("liveClock").textContent = now.toLocaleTimeString();
    }
    setInterval(updateLiveClock, 1000);
    updateLiveClock();

    function updateWhaleData() {
      fetch("/whales.json")
        .then(res => res.json())
        .then(data => {
          const trades = data.whale_trades || [];
          const ts = new Date(data.timestamp);
          document.getElementById("whaleTimestamp").textContent =
            `Last updated: ${ts.toLocaleString()}`;

          const listHTML = trades.map(t => `
            <div class="trade-card">
              <strong>${t.symbol}</strong> ‚Äî ${t.type}<br>
              Strike: $${t.strike}, Exp: ${t.expiration}, Premium: $${Number(t.premium).toLocaleString()}
            </div>
          `).join("");
          document.getElementById("whaleList").innerHTML = listHTML;

          const totalPremium = trades.reduce((sum, t) => sum + Number(t.premium), 0);
          document.getElementById("whaleMeterText").textContent =
            `Total Premium Traded: $${(totalPremium * 10000).toLocaleString()}`;

          const percent = Math.min((totalPremium * 10000 / 1000000) * 100, 100);
          const whaleFill = document.getElementById("whaleFill");
          whaleFill.style.width = percent + "%";
          whaleFill.style.background = "linear-gradient(to right, #00ff88, #ffaa00, #ff0044)";

          const bullishCount = trades.filter(t => t.type === "CALL").length;
          const bearishCount = trades.filter(t => t.type === "PUT").length;
          const totalCount = bullishCount + bearishCount;
          const bullishPct = totalCount > 0 ? (bullishCount / totalCount) * 100 : 50;
          const bearishPct = 100 - bullishPct;

          document.getElementById("bullFill").style.width = `${bullishPct}%`;
          document.getElementById("bearFill").style.width = `${bearishPct}%`;
          document.getElementById("sentimentLabel").textContent =
            `üêÇ Bullish: ${bullishPct.toFixed(1)}% | üêª Bearish: ${bearishPct.toFixed(1)}%`;
        })
        .catch(err => {
          console.error("Failed to fetch whale data:", err);
          document.getElementById("whaleTimestamp").textContent = "Failed to load whale data.";
        });
    }

    updateWhaleData();
    setInterval(updateWhaleData, 60000);

    // Sentiment Timeline
    const ctx = document.getElementById('sentimentChart').getContext('2d');
    const sentimentData = {
      labels: ["May 13", "May 14", "May 15"],
      bullish: [60, 70, 100],
      bearish: [40, 30, 0]
    };

    function generateInsight(bull, bear) {
      const latest = bull[bull.length - 1];
      const previous = bull[bull.length - 2];
      if (latest > previous && latest > 70) return "üêã Whales are getting more confident. Foam may be building before a wave.";
      if (latest < previous && latest < 50) return "‚ö†Ô∏è Whale sentiment is cooling off. Consider reducing exposure.";
      return "ü§ø Sentiment is balanced. Keep watching for signs of foam.";
    }

    new Chart(ctx, {
      type: 'line',
      data: {
        labels: sentimentData.labels,
        datasets: [
          {
            label: "üêÇ Bullish %",
            data: sentimentData.bullish,
            borderColor: "#00ff88",
            backgroundColor: "rgba(0,255,136,0.1)",
            fill: true,
            tension: 0.4
          },
          {
            label: "üêª Bearish %",
            data: sentimentData.bearish,
            borderColor: "#ff0044",
            backgroundColor: "rgba(255,0,68,0.1)",
            fill: true,
            tension: 0.4
          }
        ]
      },
      options: {
        plugins: { legend: { labels: { color: "#fff" } } },
        scales: {
          x: { ticks: { color: "#ccc" } },
          y: { ticks: { color: "#ccc" }, min: 0, max: 100 }
        }
      }
    });

    document.getElementById("sentimentInsight").textContent = generateInsight(sentimentData.bullish, sentimentData.bearish);
  </script>
</body>
</html>
