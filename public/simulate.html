<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Options Trade Simulator</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #ffffff;
      --text: #000000;
      --accent: #00ffee;
      --box: #f0f0f0;
    }

    body.dark {
      --bg: #001d2d;
      --text: #ffffff;
      --accent: #00ffee;
      --box: #002b3f;
    }

    body {
      background-color: var(--bg);
      color: var(--text);
      font-family: 'Segoe UI', sans-serif;
      margin: 0;
      padding: 2em;
      text-align: center;
      transition: background 0.3s, color 0.3s;
    }

    h1 {
      font-size: 2.5em;
      color: var(--accent);
    }

    select, input, button {
      padding: 0.6em;
      margin: 0.5em;
      font-size: 1em;
      border-radius: 8px;
      border: 1px solid var(--accent);
      background: var(--box);
      color: var(--text);
    }

    button {
      cursor: pointer;
      font-weight: bold;
    }

    .result-box {
      background: var(--box);
      color: var(--text);
      padding: 1.5em;
      margin-top: 2em;
      border-radius: 12px;
      border: 2px solid var(--accent);
      box-shadow: 0 0 10px var(--accent);
    }

    .chart-container {
      max-width: 600px;
      margin: 2em auto;
    }

    .whisper-modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      justify-content: center;
      align-items: center;
      z-index: 999;
    }

    .modal-content {
      background: var(--bg);
      color: var(--text);
      padding: 2em;
      border-radius: 12px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 0 15px var(--accent);
      text-align: left;
    }

    .modal-content input {
      width: 100%;
      margin-top: 1em;
    }

    .close-modal {
      background: #e74c3c;
      color: #fff;
      float: right;
      border: none;
      padding: 0.4em 0.8em;
      border-radius: 8px;
    }

    .advanced-btn {
      margin-top: 1em;
      padding: 0.6em 1.2em;
      background: gold;
      color: black;
      font-weight: bold;
      border: none;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <h1>üéØ Options Trade Simulator</h1>

  <select id="symbolSelect"><option value="">Loading symbols...</option></select>
  <select id="typeSelect"><option value="CALL">CALL</option><option value="PUT">PUT</option></select>
  <select id="strikeSelect"></select>
  <select id="expirationSelect"></select>

  <div>
    <button onclick="simulateTrade()">Simulate</button>
    <button onclick="resetForm()">Reset</button>
    <button onclick="toggleTheme()">üåó Toggle Theme</button>
    <button class="advanced-btn" onclick="showModal()">Advanced View</button>
  </div>

  <div id="resultBox" class="result-box">üìà Select options and click Simulate.</div>

  <div class="chart-container">
    <canvas id="profitChart" width="400" height="200"></canvas>
  </div>

  <div class="whisper-modal" id="whisperModal">
    <div class="modal-content">
      <button class="close-modal" onclick="closeModal()">X</button>
      <h2>Upgrade to Whisper+</h2>
      <p>üîç Unlock dark pool sentiment</p>
      <p>üìà Save & share simulated trades</p>
      <input type="email" placeholder="Enter your email to upgrade" />
      <button style="margin-top: 1em;">üöÄ Upgrade Now</button>
    </div>
  </div>

  <script>
    const symbolEl = document.getElementById("symbolSelect");
    const typeEl = document.getElementById("typeSelect");
    const strikeEl = document.getElementById("strikeSelect");
    const expEl = document.getElementById("expirationSelect");
    const resultBox = document.getElementById("resultBox");
    let chart;
    let trades = [];

    fetch("whales.json")
      .then(res => res.json())
      .then(data => {
        trades = data.whale_trades;
        const symbols = [...new Set(trades.map(t => t.symbol))];
        symbolEl.innerHTML = '<option value="">Select symbol</option>';
        symbols.forEach(s => {
          const opt = document.createElement("option");
          opt.value = s;
          opt.textContent = s;
          symbolEl.appendChild(opt);
        });
      });

    function updateOptions() {
      const sym = symbolEl.value;
      const type = typeEl.value;
      const matches = trades.filter(t => t.symbol === sym && t.type === type);
      const strikes = [...new Set(matches.map(t => t.strike))].sort((a, b) => a - b);
      const exps = [...new Set(matches.map(t => t.expiration))].sort();

      strikeEl.innerHTML = '';
      expEl.innerHTML = '';
      strikes.forEach(s => strikeEl.appendChild(new Option(`$${s}`, s)));
      exps.forEach(e => expEl.appendChild(new Option(e, e)));
    }

    symbolEl.addEventListener("change", updateOptions);
    typeEl.addEventListener("change", updateOptions);

    function simulateTrade() {
      const symbol = symbolEl.value;
      const type = typeEl.value;
      const strike = parseFloat(strikeEl.value);
      const exp = expEl.value;
      if (!symbol || !type || !strike || !exp) {
        resultBox.innerHTML = "‚ö†Ô∏è Please complete all fields.";
        return;
      }

      const match = trades.find(t =>
        t.symbol === symbol && t.type === type && t.strike == strike && t.expiration === exp
      );

      if (!match) {
        resultBox.innerHTML = "‚ùå No matching trade found.";
        return;
      }

      const premium = Number(match.premium);
      const breakeven = type === "CALL" ? strike + premium : strike - premium;
      const maxGain = type === "CALL" ? "Unlimited" : (premium * 100).toFixed(2);
      const maxLoss = type === "CALL"
        ? (premium * 100).toFixed(2)
        : ((strike - 0) * 100 - premium * 100).toFixed(2);

      resultBox.innerHTML = `
        ‚úÖ <strong>${symbol} ${type}</strong><br>
        Strike: $${strike} | Exp: ${exp}<br>
        Premium: $${premium.toFixed(2)} | Breakeven: $${breakeven.toFixed(2)}<br><br>
        üíµ Max Gain: ${maxGain} <br>
        üí£ Max Loss: $${maxLoss}
      `;

      drawChart(strike, premium, type);
    }

    function drawChart(strike, premium, type) {
      const x = [];
      const y = [];
      for (let p = strike - 30; p <= strike + 30; p += 2) {
        x.push(p);
        let pl = 0;
        if (type === "CALL") {
          pl = (p > strike ? (p - strike) * 100 : 0) - premium * 100;
        } else {
          pl = (p < strike ? (strike - p) * 100 : 0) - premium * 100;
        }
        y.push(pl);
      }

      if (chart) chart.destroy();

      chart = new Chart(document.getElementById("profitChart"), {
        type: "line",
        data: {
          labels: x,
          datasets: [{
            label: "P/L ($)",
            data: y,
            borderColor: "#00ffee",
            tension: 0.3
          }]
        },
        options: {
          scales: {
            x: { title: { display: true, text: "Stock Price at Expiration" }},
            y: { title: { display: true, text: "Profit/Loss" }}
          }
        }
      });
    }

    function resetForm() {
      symbolEl.value = "";
      typeEl.value = "CALL";
      strikeEl.innerHTML = "";
      expEl.innerHTML = "";
      resultBox.innerHTML = "üìà Select options and click Simulate.";
      if (chart) chart.destroy();
    }

    function toggleTheme() {
      document.body.classList.toggle("dark");
    }

    function showModal() {
      document.getElementById("whisperModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("whisperModal").style.display = "none";
    }
  </script>
</body>
</html>
